# BDD: Разработка через поведение

## Содержание
- [Что такое BDD?](#что-такое-bdd)
- [BDD vs. TDD](#bdd-vs-tdd)
- [Основные компоненты BDD](#основные-компоненты-bdd)
- [Язык Gherkin: Написание сценариев](#язык-gherkin-написание-сценариев)
- [Инструменты для BDD в JavaScript](#инструменты-для-bdd-в-javascript)
- [Практический пример: Настройка CodeceptJS](#практический-пример-настройка-codeceptjs)
- [Полезные ресурсы](#полезные-ресурсы)

## Что такое BDD?

**BDD (Behavior-Driven Development)** — это методология разработки программного обеспечения, которая выросла из TDD (Test-Driven Development). Главная цель BDD — улучшить коммуникацию между техническими специалистами (разработчиками, QA) и нетехническими участниками (менеджерами, аналитиками, заказчиками).

BDD фокусируется на описании **поведения** системы с точки зрения пользователя. Эти описания создаются на структурированном, естественном языке, понятном всем участникам процесса, и служат одновременно документацией, критериями приемки и основой для автоматизированных тестов.

## BDD vs. TDD

| Критерий     | TDD (Test-Driven Development)                        | BDD (Behavior-Driven Development)                  |
|:-------------|:-----------------------------------------------------|:---------------------------------------------------|
| **Цель**     | Покрытие кода юнит-тестами                           | Соответствие требованиям бизнеса                   |
| **Фокус**    | Техническая реализация, работа компонентов           | Поведение системы с точки зрения пользователя      |
| **Язык**     | Код (тесты пишутся разработчиками для разработчиков) | Естественный язык (Gherkin), понятный всей команде |
| **Артефакт** | Юнит-тесты                                           | Исполняемые спецификации (feature-файлы)           |

Обе методологии следуют принципу "сначала тесты, потом код", но BDD делает акцент на совместной работе и общем понимании того, ЧТО система должна делать, а TDD — на том, КАК это реализовать.

## Основные компоненты BDD

-   **Feature-файлы (`.feature`)**: Текстовые файлы, написанные на языке Gherkin. Они описывают одну фичу (функциональность) и содержат набор сценариев ее использования.
-   **Шаги (Steps)**: Отдельные строки в сценарии Gherkin, начинающиеся с ключевых слов `Given`, `When`, `Then` и т.д.
-   **Определения шагов (Step Definitions)**: Фрагменты кода (в нашем случае, функции JavaScript/TypeScript), которые связывают каждый шаг из feature-файла с конкретным действием, выполняемым фреймворком автоматизации (например, клик по кнопке, ввод текста).
-   **Test Runner**: Инструмент (например, Cucumber.js), который читает feature-файлы, находит соответствующие определения шагов и выполняет их.

## Язык Gherkin: Написание сценариев

**Gherkin** — это предметно-ориентированный язык (DSL), созданный для описания поведения системы. Его структура делает сценарии легко читаемыми.

### Ключевые слова

-   `Feature`: Описывает название функциональности.
-   `Scenario`: Описывает один конкретный сценарий использования.
-   `Given` (Дано): Описывает начальные условия, контекст.
-   `When` (Когда): Описывает ключевое действие, выполняемое пользователем.
-   `Then` (Тогда): Описывает ожидаемый результат, проверку.
-   `And`, `But` (И, Но): Используются для добавления условий к любому из предыдущих шагов.
-   `Background`: Описывает шаги, которые должны выполняться перед каждым сценарием в рамках одного `Feature`.

### Параметризация тестов: `Scenario Outline`
Позволяет выполнить один и тот же сценарий с разными наборами данных.

```gherkin
Feature: Авторизация пользователя

Scenario Outline: Попытка входа с разными данными
  Given я нахожусь на странице входа
  When я ввожу "<email>" и "<password>"
  Then я должен увидеть сообщение "<message>"

  Examples:
    | email           | password      | message                 |
    | user@test.com   | wrong-pass    | "Неверный пароль"       |
    | wrong@user.com  | 123456        | "Пользователь не найден"|
    |                 |               | "Поля не могут быть пустыми" |
```

## Инструменты для BDD в JavaScript

-   **Cucumber.js**: Самый популярный BDD-инструмент для JavaScript. Он отвечает за парсинг Gherkin и выполнение связанных с ним определений шагов.
-   **CodeceptJS**: Высокоуровневый фреймворк для end-to-end тестирования, который предоставляет удобный API и может интегрироваться с Cucumber.js для полноценной поддержки BDD.

## Практический пример: Настройка CodeceptJS

### Инициализация проекта
CodeceptJS предоставляет интерактивный мастер настройки:
```bash
npx codeceptjs init
```
В процессе настройки можно выбрать Playwright в качестве драйвера, указать пути к тестам и включить поддержку TypeScript.

### Интеграция Gherkin
Для добавления BDD-возможностей в существующий проект CodeceptJS выполните команду:
```bash
npx codeceptjs gherkin:init
```
Эта команда создаст необходимые директории (`features`, `step_definitions`) и обновит конфигурационный файл `codecept.conf.ts`.

### Написание Feature-файла
Создайте файл, например, `features/login.feature`:

```gherkin
Feature: Авторизация

  Scenario: Успешный вход в систему
    Given я нахожусь на странице входа
    When я ввожу корректные данные пользователя
    And нажимаю кнопку "Войти"
    Then я должен быть перенаправлен на главную страницу
```

### Написание Step Definitions
Создайте файл `step_definitions/steps.ts` и реализуйте каждый шаг.

```typescript
// step_definitions/steps.ts
const { I } = inject();

Given('я нахожусь на странице входа', () => {
  I.amOnPage('/login');
});

When('я ввожу корректные данные пользователя', () => {
  I.fillField('#username', 'testuser');
  I.fillField('#password', 'password123');
});

When('нажимаю кнопку {string}', (buttonText: string) => {
  I.click(buttonText);
});

Then('я должен быть перенаправлен на главную страницу', () => {
  I.seeInCurrentUrl('/dashboard');
});
```

### Запуск тестов
```bash
# Запустить все feature-файлы
npx codeceptjs run --features
```

## Полезные ресурсы
-   **Cucumber.js**: [Официальная документация](https://cucumber.io/docs/cucumber/)
-   **CodeceptJS**: [Раздел документации по BDD](https://codecept.io/bdd/)
-   **Gherkin Reference**: [Справочник по синтаксису Gherkin](https://cucumber.io/docs/gherkin/reference/)
